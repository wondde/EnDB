# λ°μ΄ν„°λ² μ΄μ¤ μ¬μ„¤κ³„ κ³Όμ •
κ°€λ‚λ‹¤λΌ 
## π“ Raw λ°μ΄ν„° λ¶„μ„

### 1. μ›λ³Έ λ°μ΄ν„° κµ¬μ΅° (KOSIS)

ν”„λ΅μ νΈλ” **3κ°μ CSV νμΌ**λ΅ μ‹μ‘ν–μµλ‹λ‹¤:

#### π“ `unemployment.csv` (μ‹¤μ—…λ¥  λ°μ΄ν„°)
```
ν–‰μ •κµ¬μ—­(μ‹λ„)λ³„ | 2017.01 | 2017.02 | ... | 2025.09
μ„μΈνΉλ³„μ‹       | 4.2     | 4.5     | ... | 2.8
λ¶€μ‚°κ΄‘μ—­μ‹       | 3.8     | 3.9     | ... | 2.5
...
```

**νΉμ§•**:
- **Wide Format** (κ°€λ΅λ΅ κΈ΄ ν•νƒ)
- 105κ° μ»¬λΌ (μ‹μ λ³„)
- 17κ° ν–‰ (μ§€μ—­λ³„)
- μΈμ½”λ”©: CP949 (ν•κΈ€ κΉ¨μ§ μ΄μ)
- λ¬Έμ μ : μ‹μ μ΄ μ»¬λΌμΌλ΅ λ¶„μ‚° β†’ λ¶„μ„ μ–΄λ ¤μ›€

#### π“ `employment_industry.csv` (μ‚°μ—…λ³„ κ³ μ©)
```
ν–‰μ •κµ¬μ—­(μ‹λ„)λ³„ | μ‚°μ—…λ³„          | 2017.01 | 2017.02 | ...
μ„μΈνΉλ³„μ‹       | A λ†μ—…, μ„μ—… λ° μ–΄μ—… | 5000    | 5100    | ...
μ„μΈνΉλ³„μ‹       | C μ μ΅°μ—…         | 950000  | 960000  | ...
...
```

**νΉμ§•**:
- **Wide Format** + λ³µν•© ν‚¤
- 110κ° μ»¬λΌ (μ‹μ λ³„)
- 180κ° ν–‰ (17κ° μ§€μ—­ Γ— μ‚°μ—…)
- μ‚°μ—… μ½”λ“: μ•νλ²³ + ν•κΈ€λ… νΌμ¬
- λ¬Έμ μ : λ³µν•© κ·Έλ£Ή ν‘μ‹ (`* μ‚¬νκ°„μ ‘μλ³Έ...`) μ²λ¦¬ ν•„μ”

#### π“ `population.csv` (μΈκµ¬ λ°μ΄ν„°)
```
ν–‰μ •κµ¬μ—­(μ‹κµ°κµ¬)λ³„ | 2017.01 | 2017.02 | ... | 2025.09
μ„μΈνΉλ³„μ‹         | 9,930,478 | 9,931,412 | ...
λ¶€μ‚°κ΄‘μ—­μ‹         | 3,496,779 | 3,495,478 | ...
...
```

**νΉμ§•**:
- **Wide Format** (μ›”λ³„!)
- 316κ° μ»¬λΌ (105κ°μ›” Γ— 3κ° λ©”νΈλ¦­)
- 18κ° ν–‰ (μ§€μ—­λ³„)
- μ‹¤μ λ΅λ” μ›”λ³„ λ°μ΄ν„° (μ΄μΈκµ¬μ, λ‚¨μμΈκµ¬μ, μ—¬μμΈκµ¬μ)

---

## π”„ ETL κ³Όμ • (λ°μ΄ν„° μ •μ )

### Step 1: Tidy Data λ³€ν™ (Wide β†’ Long)

**Before (Wide Format)**:
```
μ§€μ—­      | 2017.01 | 2017.02 | 2017.03
μ„μΈνΉλ³„μ‹ | 4.2     | 4.5     | 4.3
```

**After (Long Format)**:
```
μ§€μ—­      | year_month | unemployment_rate
μ„μΈνΉλ³„μ‹ | 2017-01    | 4.2
μ„μΈνΉλ³„μ‹ | 2017-02    | 4.5
μ„μΈνΉλ³„μ‹ | 2017-03    | 4.3
```

**κµ¬ν„** ([src/etl.py](src/etl.py)):
```python
# Wide β†’ Long λ³€ν™
tidy = df.melt(
    id_vars=["μ‹λ„λ³„"],
    var_name="μ‹μ ",
    value_name="μ‹¤μ—…λ¥ "
)
```

---

### Step 2: λ°μ΄ν„° μ •κ·ν™”

#### λ¬Έμ  1: λ‚ μ§ ν•μ‹ λ¶μΌμΉ
**λ¬Έμ **: `2017.10` β†’ Float λ³€ν™ μ‹ `2017.1`λ΅ μ†μ‹¤

**ν•΄κ²°**:
```python
# StringμΌλ΅ μ½κΈ° + Zero-padding
df = pd.read_csv(csv_path, dtype={"μ‹μ ": str})
tidy["year_month"] = (
    date_parts[0] + "-" + date_parts[1].str.zfill(2)
)
# κ²°κ³Ό: "2017-10" (10μ›” λ°μ΄ν„° λ³µκµ¬)
```

#### λ¬Έμ  2: μ§€μ—­λ… λ¶μΌμΉ
**λ¬Έμ **: "μ μ£Όλ„" vs "μ μ£ΌνΉλ³„μμΉλ„"

**ν•΄κ²°**:
```python
tidy["region_name"] = tidy["region_name"].str.strip().replace({
    "μ μ£Όλ„": "μ μ£ΌνΉλ³„μμΉλ„"
})
```

#### λ¬Έμ  3: μ‚°μ—… μ½”λ“ μ¶”μ¶
**λ¬Έμ **: `"A λ†μ—…, μ„μ—… λ° μ–΄μ—…"` β†’ μ½”λ“μ™€ μ΄λ¦„ λ¶„λ¦¬ ν•„μ”

**ν•΄κ²°**:
```python
# μ •κ·μ‹μΌλ΅ λ¶„λ¦¬
industry_info = tidy["industry_raw"].str.extract(
    r"^(?P<industry_code>[A-Z])\s+(?P<industry_name>.+)$"
)

# λ³µν•© κ·Έλ£Ή μ²λ¦¬ (μ: "* μ‚¬νκ°„μ ‘μλ³Έ...")
mask_compound = tidy["industry_raw"].str.contains(r"^\*", na=False)
compound_info = tidy.loc[mask_compound, "industry_raw"].str.extract(
    r"^\*\s*(?P<industry_name>[^(]+)"
)
```

---

## π—οΈ λ°μ΄ν„°λ² μ΄μ¤ μ„¤κ³„

### μ„¤κ³„ μ² ν•™: **Galaxy Schema (ν©νΈ μ—¬λ¬ κ° + κ³µμ  λ””λ©μ…)**

```
        dim_region (μ°¨μ› ν…μ΄λΈ”)
              β†“
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β†“         β†“         β†“
fact_unemployment  fact_employment  fact_population
(μ‹¤μ—…λ¥  ν©νΈ)      (κ³ μ© ν©νΈ)      (μΈκµ¬ ν©νΈ)
                   β†‘
        dim_industry (μ°¨μ› ν…μ΄λΈ”)
```

**μ„ νƒ μ΄μ **:
1. **λ¶„μ„ μµμ ν™”**: μ§‘κ³„ μΏΌλ¦¬ μ„±λ¥ ν–¥μƒ
2. **μ°¨μ› κ³µμ λ΅ κµμ°¨λ¶„μ„μ΄ μ‰¬μ›€**: (conformed dimension)
3. **ν™•μ¥μ„±**: μƒλ΅μ΄ Fact ν…μ΄λΈ” μ¶”κ°€ μ©μ΄

---

### ν…μ΄λΈ” μ„¤κ³„

#### 1. Dimension ν…μ΄λΈ” (μ°¨μ›)

**`dim_region` (μ§€μ—­)**
```sql
CREATE TABLE dim_region (
    region_id   INTEGER PRIMARY KEY,    -- 1~17
    region_name TEXT NOT NULL UNIQUE    -- "μ„μΈνΉλ³„μ‹", ...
);
```

**λ°μ΄ν„° μμ‹**:
```
region_id | region_name
----------|---------------
11        | μ„μΈνΉλ³„μ‹
26        | λ¶€μ‚°κ΄‘μ—­μ‹
```

**μƒμ„± λ°©μ‹** ([src/etl.py](src/etl.py)):
```python
REGION_CODE_MAP = {
    "μ„μΈνΉλ³„μ‹": 11,
    "λ¶€μ‚°κ΄‘μ—­μ‹": 26,
    # ... (17κ° μ§€μ—­)
}

def create_dimension_region() -> pd.DataFrame:
    return pd.DataFrame([
        {"region_id": code, "region_name": name}
        for name, code in REGION_CODE_MAP.items()
    ])
```

---

**`dim_industry` (μ‚°μ—…)**
```sql
CREATE TABLE dim_industry (
    industry_code TEXT PRIMARY KEY,     -- "A", "C", "μ‚¬νκ°„μ ‘μλ³Έ..."
    industry_name TEXT NOT NULL         -- "λ†μ—…, μ„μ—… λ° μ–΄μ—…"
);
```

**λ°μ΄ν„° μμ‹**:
```
industry_code | industry_name
--------------|--------------------------------
A             | λ†μ—…, μ„μ—… λ° μ–΄μ—…
C             | μ μ΅°μ—…
μ‚¬νκ°„μ ‘μλ³Έ... | μ‚¬νκ°„μ ‘μλ³Έ λ° κΈ°νƒ€μ„λΉ„μ¤μ—…
```

**νΉμ§•**:
- μ•νλ²³ μ½”λ“ (A-U) + λ³µν•© κ·Έλ£Ή (ν•κΈ€λ…)
- ETLμ—μ„ μλ™ μ¶”μ¶

---

#### 2. Fact ν…μ΄λΈ” (μ‚¬μ‹¤)

**`fact_unemployment_monthly` (μ›”λ³„ μ‹¤μ—…λ¥ )**
```sql
CREATE TABLE fact_unemployment_monthly (
    region_id          INTEGER NOT NULL,
    year_month         TEXT NOT NULL,       -- "2017-01"
    unemployment_rate  REAL NOT NULL,       -- 4.2 (%)
    unemployment_level INTEGER,             -- 210000 (λ…)
    labor_force        INTEGER,             -- 5000000 (λ…)
    employed_persons   INTEGER,             -- 4790000 (λ…)
    PRIMARY KEY (region_id, year_month),
    FOREIGN KEY (region_id) REFERENCES dim_region(region_id)
);
```

**λ°μ΄ν„° λ³€ν™**:
```
Raw:
μ„μΈνΉλ³„μ‹ | 2017.01 | 4.2

β†“ ETL

Fact:
region_id | year_month | unemployment_rate
11        | 2017-01    | 4.2
```

**ν–‰ μ**: 1,785κ±΄ (17κ° μ§€μ—­ Γ— 105κ°μ›”)

---

**`fact_employment_by_industry_monthly` (μ‚°μ—…λ³„ κ³ μ©)**
```sql
CREATE TABLE fact_employment_by_industry_monthly (
    region_id        INTEGER NOT NULL,
    industry_code    TEXT NOT NULL,
    year_month       TEXT NOT NULL,
    employed_persons INTEGER NOT NULL,
    PRIMARY KEY (region_id, industry_code, year_month),
    FOREIGN KEY (region_id) REFERENCES dim_region(region_id),
    FOREIGN KEY (industry_code) REFERENCES dim_industry(industry_code)
);
```

**λ°μ΄ν„° λ³€ν™**:
```
Raw:
μ„μΈνΉλ³„μ‹ | A λ†μ—…, μ„μ—… λ° μ–΄μ—… | 2017.01 | 5000

β†“ ETL (μ‚°μ—… μ½”λ“ λ¶„λ¦¬)

Fact:
region_id | industry_code | year_month | employed_persons
11        | A             | 2017-01    | 5000

Dimension:
industry_code | industry_name
A             | λ†μ—…, μ„μ—… λ° μ–΄μ—…
```

**ν–‰ μ**: 14,271κ±΄ (17κ° μ§€μ—­ Γ— 26κ° μ‚°μ—… Γ— 105κ°μ›”, NULL μ μ™Έ)

---

**`fact_population_monthly` (μ›”λ³„ μΈκµ¬) β­ μ‹ κ·**
```sql
CREATE TABLE fact_population_monthly (
    region_id   INTEGER NOT NULL,
    year_month  TEXT NOT NULL,         -- "2017-01"
    total_pop   INTEGER NOT NULL,      -- 9930478 (μ‹¤μ  μ›”λ³„ λ°μ΄ν„°)
    PRIMARY KEY (region_id, year_month),
    FOREIGN KEY (region_id) REFERENCES dim_region(region_id)
);
```

**λ°μ΄ν„° λ³€ν™**:
```
Raw:
μ„μΈνΉλ³„μ‹ | 2017.01 | 9,930,478

β†“ ETL (Wide β†’ Long)

Fact:
region_id | year_month | total_pop
11        | 2017-01    | 9930478
```

**νΉμ§•**:
- μ‹¤μ  μ›”λ³„ μΈκµ¬ λ°μ΄ν„° (λ³΄κ°„ μ•„λ‹!)
- ML λ¶„μ„ μ‹ μ •ν™•ν• μ›”λ³„ JOIN κ°€λ¥

**ν–‰ μ**: 1,575κ±΄ (15κ° μ§€μ—­ Γ— 105κ°μ›”)

---

**`fact_population_yearly` (μ—°λ„λ³„ μΈκµ¬)**
```sql
CREATE TABLE fact_population_yearly (
    region_id  INTEGER NOT NULL,
    year       INTEGER NOT NULL,      -- 2017
    total_pop  INTEGER NOT NULL,      -- 9800000 (μ›”λ³„ ν‰κ· )
    youth_pop  INTEGER,               -- 1200000
    youth_rate REAL,                  -- 12.24 (%)
    PRIMARY KEY (region_id, year),
    FOREIGN KEY (region_id) REFERENCES dim_region(region_id)
);
```

**νΉμ§•**:
- μ›”λ³„ λ°μ΄ν„°μ μ—°λ„λ³„ ν‰κ· 
- νΈν™μ„± μ μ§€λ¥Ό μ„ν•΄ μ΅΄μ¬

**ν–‰ μ**: 135κ±΄ (15κ° μ§€μ—­ Γ— 9λ…„)

---

## π”‘ ν•µμ‹¬ μ„¤κ³„ κ²°μ •

### 1. Star Schema μ„ νƒ

**μ¥μ **:
- β… λ¶„μ„ μΏΌλ¦¬ λ‹¨μν™”
- β… μ§‘κ³„ μ„±λ¥ ν–¥μƒ
- β… λΉ„μ¦λ‹μ¤ λ΅μ§ λ…ν™•ν™”

**μμ‹ μΏΌλ¦¬**:
```sql
-- μ§€μ—­λ³„ ν‰κ·  μ‹¤μ—…λ¥ 
SELECT
    r.region_name,
    AVG(u.unemployment_rate) as avg_rate
FROM fact_unemployment_monthly u
JOIN dim_region r ON u.region_id = r.region_id
GROUP BY r.region_name;
```

---

### 2. μ •κ·ν™” (3NF)

**μ 1μ •κ·ν• (1NF)**:
- β… μ›μκ°’λ§ μ €μ¥ (Wide β†’ Long λ³€ν™)
- β… λ°λ³µ κ·Έλ£Ή μ κ±°

**μ 2μ •κ·ν• (2NF)**:
- β… λ¶€λ¶„ ν•¨μ μΆ…μ† μ κ±°
- β… region_name β†’ dim_region λ¶„λ¦¬

**μ 3μ •κ·ν• (3NF)**:
- β… μ΄ν–‰ ν•¨μ μΆ…μ† μ κ±°
- β… industry_name β†’ dim_industry λ¶„λ¦¬

---

### 3. λ°μ΄ν„° λ¬΄κ²°μ„±

**Primary Key (PK)**:
- λ¨λ“  ν…μ΄λΈ”μ— PK μ •μ
- Fact ν…μ΄λΈ”: λ³µν•© ν‚¤ μ‚¬μ©

**Foreign Key (FK)**:
```sql
FOREIGN KEY (region_id)
    REFERENCES dim_region(region_id)
    ON UPDATE CASCADE
    ON DELETE RESTRICT
```

**μ μ•½μ΅°κ±΄**:
- `NOT NULL`: ν•„μ μ»¬λΌ
- `UNIQUE`: μ¤‘λ³µ λ°©μ§€ (region_name)

---

## π“ λ°μ΄ν„° ν’μ§ κ°μ„ 

### Before (Raw λ°μ΄ν„°)

| μ§€ν‘ | κ°’ |
|------|-----|
| 10μ›” λ°μ΄ν„° | β μ†μ‹¤ (136κ±΄) |
| μ μ£Ό λ°μ΄ν„° | β μ†μ‹¤ (97κ°μ›”) |
| μ‚°μ—… λ°μ΄ν„° | β 94.7% μ†μ‹¤ (3/26) |
| NULL λΉ„μ¨ | λ¶λ… |

### After (μ¬μ„¤κ³„ ν›„)

| μ§€ν‘ | κ°’ |
|------|-----|
| 10μ›” λ°μ΄ν„° | β… λ³µκµ¬ (136κ±΄) |
| μ μ£Ό λ°μ΄ν„° | β… λ³µκµ¬ (97κ°μ›”) |
| μ‚°μ—… λ°μ΄ν„° | β… λ³µκµ¬ (26κ° μ „μ²΄) |
| NULL λΉ„μ¨ | **0%** |
| λ³‘ν•© μ„±κ³µλ¥  | **100%** |
| μ™Έλν‚¤ μ„λ° | **0κ±΄** |

---

## π”„ ETL νμ΄ν”„λΌμΈ μ”μ•½

```
Raw Data (CSV)
    β†“ extract_*()
Tidy Data (Long Format)
    β†“ μ •μ  (λ‚ μ§, μ§€μ—­λ…, μ‚°μ—… μ½”λ“)
Normalized Data
    β†“ create_dimension_*()
Dimension Tables (dim_region, dim_industry)
    β†“ to_sql()
SQLite Database
    β†“ SQL Queries
λ¶„μ„ κ²°κ³Ό (Insights)
```

**μ½”λ“ μ„μΉ**:
- [src/etl.py](src/etl.py) - ETL λ΅μ§
- [src/db_loader.py](src/db_loader.py) - DB μ μ¬
- [sql/create_tables_sqlite.sql](sql/create_tables_sqlite.sql) - DDL

---

## π’΅ μ„¤κ³„ μ‹ κ³ λ ¤μ‚¬ν•­

### 1. SQLite μ„ νƒ μ΄μ 

**μ¥μ **:
- νμΌ κΈ°λ° (ν¬ν„°λΈ”)
- λΉ„λ°€λ²νΈ λ¶ν•„μ”
- 1λ§ κ±΄ μμ¤€ μ¶©λ¶„ν• μ„±λ¥

**λ‹¨μ  (ν•΄κ²°)**:
- `STDDEV()` μ—†μ β†’ μ§μ ‘ κ³„μ‚°
- `TRUNCATE` μ—†μ β†’ `DELETE` μ‚¬μ©

---

### 2. λ‚ μ§ ν•μ‹

**μ„ νƒ**: `TEXT` (μ: "2017-01")

**μ΄μ **:
- SQLiteμ DATE νƒ€μ… λ¶€μ΅±
- `SUBSTR()`, `CAST()` μΏΌλ¦¬ μ§€μ›
- μ •λ ¬ κ°€λ¥ (ISO 8601 ν•μ‹)

---

### 3. μ§€μ—­ μ½”λ“ λ§¤ν•‘

**μ„ νƒ**: ν†µκ³„μ²­ ν‘μ¤€ μ½”λ“ μ‚¬μ©

```python
REGION_CODE_MAP = {
    "μ„μΈνΉλ³„μ‹": 11,
    "λ¶€μ‚°κ΄‘μ—­μ‹": 26,
    "λ€κµ¬κ΄‘μ—­μ‹": 27,
    # ...
}
```

**μ΄μ **:
- κ³µμ‹ ν‘μ¤€ μ¤€μ
- λ‹¤λ¥Έ KOSIS λ°μ΄ν„°μ™€ νΈν™

---

## π“ μµμΆ… λ°μ΄ν„°λ² μ΄μ¤ ν†µκ³„

| ν•­λ© | κ°’ |
|------|-----|
| ν…μ΄λΈ” μ | 6κ° (Dim 2 + Fact 4) |
| μ΄ ν–‰ μ | 17,793κ±΄ |
| NULL λΉ„μ¨ | 0% |
| μ •κ·ν™” μμ¤€ | 3NF |
| μ™Έλν‚¤ μ | 7κ° |
| μΈλ±μ¤ μ | 3κ° (μ„±λ¥ μµμ ν™”) |

**ν…μ΄λΈ”λ³„ ν–‰ μ**:
- dim_region: 17κ±΄
- dim_industry: 26κ±΄
- fact_unemployment_monthly: 1,785κ±΄
- fact_employment_by_industry_monthly: 14,271κ±΄
- fact_population_monthly: 1,575κ±΄ β­
- fact_population_yearly: 135κ±΄

---

## π― κ²°λ΅ 

### μ¬μ„¤κ³„μ ν•µμ‹¬ μ„±κ³Ό

1. **λ°μ΄ν„° μ†μ‹¤ λ³µκµ¬**: 10μ›”, μ μ£Ό, μ‚°μ—… λ°μ΄ν„° μ „μ²΄ λ³µκµ¬
2. **κµ¬μ΅° κ°μ„ **: Wide β†’ Star Schema (λ¶„μ„ μµμ ν™”)
3. **ν’μ§ ν–¥μƒ**: NULL 0%, λ³‘ν•© μ„±κ³µλ¥  100%
4. **μ μ§€λ³΄μμ„±**: λ¨λ“ν™”λ ETL, SQL κΈ°λ° λ¶„μ„
5. **ν™•μ¥μ„±**: μƒλ΅μ΄ λ°μ΄ν„° μ¶”κ°€ μ©μ΄


