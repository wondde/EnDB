# 데이터베이스 테이블 구조 정의

## 1. 차원 테이블 (Dimension Tables)

### 1.1 dim_region (지역)

지역 정보를 관리하는 차원 테이블

```sql
CREATE TABLE dim_region (
    region_id   INTEGER PRIMARY KEY,
    region_name TEXT NOT NULL UNIQUE,
    region_area TEXT NOT NULL
);
```

**컬럼 설명:**
- `region_id`: 지역 코드 (기본키)
- `region_name`: 지역명 (예: '서울특별시', '부산광역시')
- `region_area`: 권역 (예: '수도권', '영남권', '호남권')

**데이터 예시:**
| region_id | region_name | region_area |
|-----------|-------------|-------------|
| 11 | 서울특별시 | 수도권 |
| 26 | 부산광역시 | 영남권 |
| 27 | 대구광역시 | 영남권 |

**행 수:** 17개 지역

---

### 1.2 dim_industry (산업)

산업 분류 정보를 관리하는 차원 테이블

```sql
CREATE TABLE dim_industry (
    industry_id   TEXT PRIMARY KEY,
    industry_name TEXT NOT NULL UNIQUE,
    industry_category TEXT NOT NULL
);
```

**컬럼 설명:**
- `industry_id`: 산업 코드 (기본키, KSIC 대분류 코드)
- `industry_name`: 산업명 (예: '제조업', '건설업')
- `industry_category`: 산업 분류 (예: '대분류')

**데이터 예시:**
| industry_id | industry_name | industry_category |
|-------------|---------------|-------------------|
| C | 제조업 | 대분류 |
| F | 건설업 | 대분류 |
| G | 도매 및 소매업 | 대분류 |

**행 수:** 19개 산업 (KSIC 대분류 기준)

---

## 2. 사실 테이블 (Fact Tables)

### 2.1 fact_employment_monthly (월별 고용지표)

지역별-월별 고용 지표 데이터를 저장하는 사실 테이블

```sql
CREATE TABLE fact_employment_monthly (
    region_id           INTEGER NOT NULL,
    year_month          TEXT NOT NULL,
    economically_active INTEGER NOT NULL,
    employed            INTEGER NOT NULL,
    unemployed          INTEGER NOT NULL,
    unemployment_rate   REAL NOT NULL,
    PRIMARY KEY (region_id, year_month),
    FOREIGN KEY (region_id) REFERENCES dim_region(region_id),
    CHECK (unemployment_rate >= 0 AND unemployment_rate <= 100),
    CHECK (economically_active >= 0),
    CHECK (employed >= 0),
    CHECK (unemployed >= 0)
);
```

**컬럼 설명:**
- `region_id`: 지역 코드 (외래키)
- `year_month`: 연월 (예: '2024-03')
- `economically_active`: 경제활동인구 (천명)
- `employed`: 취업자 수 (천명)
- `unemployed`: 실업자 수 (천명)
- `unemployment_rate`: 실업률 (%)

**데이터 예시:**
| region_id | year_month | economically_active | employed | unemployed | unemployment_rate |
|-----------|------------|---------------------|----------|------------|-------------------|
| 11 | 2024-03 | 5200 | 4900 | 300 | 5.8 |
| 11 | 2024-04 | 5210 | 4920 | 290 | 5.6 |

**제약조건:**
- `economically_active = employed + unemployed` (데이터 일관성)
- `unemployment_rate = (unemployed / economically_active) * 100`

**행 수:** 약 1,785개 (17개 지역 × 105개월)

---

### 2.2 fact_industry_employment (산업별 취업자)

지역-산업-월별 취업자 데이터를 저장하는 사실 테이블

```sql
CREATE TABLE fact_industry_employment (
    region_id        INTEGER NOT NULL,
    industry_id      TEXT NOT NULL,
    year_month       TEXT NOT NULL,
    employed_count   INTEGER NOT NULL,
    employment_rate  REAL,
    PRIMARY KEY (region_id, industry_id, year_month),
    FOREIGN KEY (region_id) REFERENCES dim_region(region_id),
    FOREIGN KEY (industry_id) REFERENCES dim_industry(industry_id),
    CHECK (employed_count >= 0),
    CHECK (employment_rate IS NULL OR (employment_rate >= 0 AND employment_rate <= 100))
);
```

**컬럼 설명:**
- `region_id`: 지역 코드 (외래키)
- `industry_id`: 산업 코드 (외래키)
- `year_month`: 연월 (예: '2024-03')
- `employed_count`: 산업별 취업자 수 (천명)
- `employment_rate`: 산업별 고용 비중 (%)

**데이터 예시:**
| region_id | industry_id | year_month | employed_count | employment_rate |
|-----------|-------------|------------|----------------|-----------------|
| 11 | C | 2024-03 | 800 | 16.3 |
| 11 | F | 2024-03 | 350 | 7.1 |

**관계 특성:**
- 지역(M) ↔ 산업(N)의 다대다(M:N) 관계를 해소하는 연결 테이블
- 복합 기본키: (region_id, industry_id, year_month)

**행 수:** 약 33,915개 (17개 지역 × 19개 산업 × 105개월)

---

### 2.3 fact_population_yearly (연도별 인구)

지역별-연도별 인구 통계 데이터 (선택적)

```sql
CREATE TABLE fact_population_yearly (
    region_id  INTEGER NOT NULL,
    year       INTEGER NOT NULL,
    total_pop  INTEGER NOT NULL,
    youth_pop  INTEGER,
    youth_rate REAL,
    PRIMARY KEY (region_id, year),
    FOREIGN KEY (region_id) REFERENCES dim_region(region_id),
    CHECK (total_pop >= 0),
    CHECK (youth_pop IS NULL OR youth_pop >= 0),
    CHECK (youth_rate IS NULL OR (youth_rate >= 0 AND youth_rate <= 100))
);
```

**컬럼 설명:**
- `region_id`: 지역 코드 (외래키)
- `year`: 연도 (예: 2024)
- `total_pop`: 총 인구 (명)
- `youth_pop`: 청년 인구 (명)
- `youth_rate`: 청년 인구 비율 (%)

**데이터 예시:**
| region_id | year | total_pop | youth_pop | youth_rate |
|-----------|------|-----------|-----------|------------|
| 11 | 2024 | 9800000 | 1200000 | 12.24 |

**특징:**
- 월별 데이터의 연도별 평균값
- 호환성 및 추가 분석을 위해 존재

**행 수:** 약 153개 (17개 지역 × 9년)

---

## 3. ER 다이어그램

```
┌─────────────┐
│ dim_region  │
│─────────────│
│ region_id   │ (PK)
│ region_name │
│ region_area │
└──────┬──────┘
       │ 1
       │
       │ N
┌──────┴──────────────────────┐
│ fact_employment_monthly     │
│─────────────────────────────│
│ region_id, year_month       │ (PK)
│ economically_active         │
│ employed                    │
│ unemployed                  │
│ unemployment_rate           │
└─────────────────────────────┘


┌──────────────┐              ┌───────────────┐
│ dim_region   │              │ dim_industry  │
│──────────────│              │───────────────│
│ region_id    │ (PK)         │ industry_id   │ (PK)
│ region_name  │              │ industry_name │
│ region_area  │              │ industry_cat  │
└──────┬───────┘              └───────┬───────┘
       │ 1                            │ 1
       │                              │
       │ N                            │ N
       │    ┌────────────────────┐    │
       └───>│fact_industry_empl  │<───┘
            │────────────────────│
            │ region_id          │ (FK, PK)
            │ industry_id        │ (FK, PK)
            │ year_month         │ (PK)
            │ employed_count     │
            │ employment_rate    │
            └────────────────────┘
```

---

## 4. 정규화 분석

### 4.1 제1정규형 (1NF)
- 모든 컬럼은 원자값(atomic value)만 저장
- 반복 그룹 없음 ✓

### 4.2 제2정규형 (2NF)
- 모든 비키 속성이 기본키 전체에 완전 함수 종속
- 부분 함수 종속 없음 ✓

### 4.3 제3정규형 (3NF)
- 모든 비키 속성이 기본키에만 종속
- 이행적 함수 종속 없음 ✓
- 지역명, 산업명 등은 각각의 차원 테이블로 분리되어 중복 제거됨

---

## 5. 인덱스 전략

### 5.1 기본 인덱스 (자동 생성)
```sql
-- 기본키에 자동 생성되는 인덱스
-- dim_region(region_id)
-- dim_industry(industry_id)
-- fact_employment_monthly(region_id, year_month)
-- fact_industry_employment(region_id, industry_id, year_month)
```

### 5.2 추가 권장 인덱스
```sql
-- 지역명 검색 최적화
CREATE INDEX idx_region_name ON dim_region(region_name);

-- 산업명 검색 최적화
CREATE INDEX idx_industry_name ON dim_industry(industry_name);

-- 시간 범위 조회 최적화
CREATE INDEX idx_employment_yearmonth ON fact_employment_monthly(year_month);
CREATE INDEX idx_industry_emp_yearmonth ON fact_industry_employment(year_month);

-- 산업별 조회 최적화
CREATE INDEX idx_industry_emp_industry ON fact_industry_employment(industry_id);
```

---

## 6. 데이터 무결성 제약조건 요약

| 제약 유형 | 적용 대상 | 설명 |
|----------|----------|------|
| PRIMARY KEY | 모든 테이블 | 각 행의 고유성 보장 |
| FOREIGN KEY | 사실 테이블 | 참조 무결성 보장 |
| UNIQUE | dim_region.region_name<br>dim_industry.industry_name | 중복 방지 |
| CHECK | unemployment_rate<br>employment_rate | 값의 범위 제한 (0~100) |
| CHECK | 모든 인구/취업자 수 | 음수 방지 (>= 0) |
| NOT NULL | 주요 컬럼 | 필수 값 보장 |

---

## 7. 테이블 크기 추정

| 테이블명 | 예상 행 수 | 비고 |
|---------|-----------|------|
| dim_region | 17 | 17개 광역시도 |
| dim_industry | 19 | KSIC 대분류 19개 |
| fact_employment_monthly | 1,785 | 17 × 105개월 |
| fact_industry_employment | 33,915 | 17 × 19 × 105개월 |
| fact_population_yearly | 153 | 17 × 9년 |
| **전체** | **35,889** | |

**예상 DB 크기:** 약 5~10 MB (SQLite)
